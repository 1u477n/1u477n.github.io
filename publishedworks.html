<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="A curated list of papers and patents." />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#070A12" id="themeColor">
  <title>Published Works · Synthetic Chronicles</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VW323NJP26"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-VW323NJP26');
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">  
  <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
  <style>
    :root{
      /* Dark Theme (Default) */
      --bg0: #050505;
      --bg1: #0A0A0A;
      --text: #F2F2F2;
      --muted: rgba(255,255,255,0.7);
      --muted2: rgba(255,255,255,0.5);      
      
      --panel: rgba(20, 20, 20, 0.6);
      --panel-hover: rgba(30, 30, 30, 0.8);
      --stroke: rgba(255,255,255,0.08);
      --stroke-hover: rgba(255,255,255,0.2);      
      
      --a1: #38BDF8; /* Sky */
      --a2: #818CF8; /* Violet */
      --a3: #34D399; /* Emerald */      
      
      --grad: linear-gradient(135deg, var(--a1), var(--a2));
      --ring: 0 0 0 2px rgba(56,189,248,.55);      
      
      --shadow: 0 0 0 1px var(--stroke), 0 4px 20px rgba(0,0,0,0.4);
      --glow: 0 0 40px -10px var(--a1);      
      
      --r20: 20px;
      --r24: 24px;
      --max: 1160px;

      /* AI Agent Specific Variables (Dark) */
      --ai-window-bg: rgba(15, 15, 15, 0.85);
      --ai-header-bg: rgba(255, 255, 255, 0.03);
      --ai-input-base: rgba(0, 0, 0, 0.4);
      --ai-bot-bubble: rgba(255, 255, 255, 0.06);
      --ai-bot-border: rgba(255, 255, 255, 0.05);
      --ai-user-bubble: var(--a1);
      --ai-user-text: #050505;
      --ai-accent: var(--a1);
    }

    /* Light Theme Override */
    [data-theme="light"] {
      --bg0: #F9FAFB;
      --bg1: #F3F4F6;
      --text: #111827;
      --muted: rgba(0,0,0,0.7);
      --muted2: rgba(0,0,0,0.5);      
      
      --panel: rgba(255, 255, 255, 0.7);
      --panel-hover: rgba(255, 255, 255, 0.95);
      --stroke: rgba(0,0,0,0.08);
      --stroke-hover: rgba(0,0,0,0.2);      
      
      --shadow: 0 0 0 1px var(--stroke), 0 4px 15px rgba(0,0,0,0.05);
      --ring: 0 0 0 2px rgba(56,189,248,.45);

      /* AI Agent Specific Variables (Light) */
      --ai-window-bg: rgba(255, 255, 255, 0.9);
      --ai-header-bg: rgba(0, 0, 0, 0.02);
      --ai-input-base: rgba(240, 240, 240, 0.7);
      --ai-bot-bubble: #FFFFFF;
      --ai-bot-border: rgba(0, 0, 0, 0.08);
      --ai-user-bubble: var(--a2);
      --ai-user-text: #FFFFFF;
      --ai-accent: var(--a2);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background-color: var(--bg0);
      color: var(--text);
      overflow-x: hidden;
      padding: 20px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* --- Background FX --- */
    .bg-orbs { position: fixed; inset: 0; z-index: -1; pointer-events: none; background: var(--bg0); overflow: hidden; }
    .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 10s infinite ease-in-out alternate; }
    .orb-1 { width: 600px; height: 600px; background: var(--a1); top: -10%; left: -10%; animation-delay: 0s; }
    .orb-2 { width: 500px; height: 500px; background: var(--a2); bottom: -10%; right: -10%; animation-delay: -2s; }
    .orb-3 { width: 400px; height: 400px; background: var(--a3); top: 40%; left: 40%; opacity: 0.2; animation-delay: -5s; }

    @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 30px); } }

    .bg-noise { position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.05; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); }

    .container{ max-width: var(--max); margin: 0 auto; position: relative; z-index: 1; }

    /* Top Bar */
    .topbar { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--panel); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--stroke); border-radius: 99px; margin-bottom: 24px; box-shadow: var(--shadow); position: sticky; top: 20px; z-index: 100; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .theme-toggle { width: 36px; height: 36px; border-radius: 50%; background: var(--grad); border: 0; cursor: pointer; display: grid; place-items: center; color: white; box-shadow: 0 4px 12px rgba(56, 189, 248, 0.4); transition: transform 0.2s ease; }
    .theme-toggle:hover { transform: scale(1.05); }
    .theme-toggle svg { width: 18px; height: 18px; }
    [data-theme="dark"] .sun { display: none; }
    [data-theme="light"] .moon { display: none; }
    .brand-text { display: flex; flex-direction: column; line-height: 1.2; }
    .brand-text strong { font-size: 14px; font-weight: 700; }
    .brand-text span { font-size: 12px; color: var(--muted2); }

    .menu-btn { width: 40px; height: 40px; display: grid; place-items: center; border-radius: 50%; border: 1px solid var(--stroke); background: rgba(255,255,255,0.05); color: var(--text); cursor: pointer; transition: 0.2s; }
    .menu-btn:hover { background: rgba(255,255,255,0.1); border-color: var(--text); }

    /* Menu Panel */
    .menu{ position: fixed; top: 80px; right: 20px; width: min(300px, 90vw); background: var(--panel-hover); border: 1px solid var(--stroke); border-radius: 20px; backdrop-filter: blur(24px); box-shadow: 0 20px 50px rgba(0,0,0,0.5); padding: 8px; display: none; z-index: 999; flex-direction: column; gap: 4px; }
    .menu.open { display: flex; animation: fadeDown 0.2s ease-out; }
    @keyframes fadeDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .menu a { padding: 12px 16px; text-decoration: none; color: var(--text); font-size: 14px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
    .menu a:hover { background: rgba(255,255,255,0.08); }
    .menu a span { font-size: 16px; opacity: 0.5; }

    /* Hero */
    .hero { text-align: center; padding: 60px 20px; margin-bottom: 40px; }
    .hero h1 { font-size: clamp(32px, 6vw, 56px); margin: 0 0 16px; letter-spacing: -0.03em; line-height: 1; }
    .grad-text { background: linear-gradient(135deg, var(--text) 30%, var(--a1)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subhead { font-size: 18px; color: var(--muted); max-width: 600px; margin: 0 auto; line-height: 1.6; }

    /* Awards Grid */
    .awards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; }
    .award-card { background: var(--panel); border: 1px solid var(--stroke); border-radius: 24px; padding: 24px; display: flex; flex-direction: column; gap: 16px; text-decoration: none; color: var(--text); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); position: relative; overflow: hidden; min-height: 180px; }
    .award-card::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(120deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%); transform: translateX(-100%); transition: transform 0.6s; }
    .award-card:hover { transform: translateY(-5px); border-color: var(--a2); background: var(--panel-hover); box-shadow: 0 15px 40px -10px rgba(129, 140, 248, 0.2); }
    .award-card:hover::before { transform: translateX(100%); }
    .award-title { font-size: 16px; line-height: 1.5; margin: 0; font-weight: 700; }
    .meta { margin-top: auto; display: flex; justify-content: space-between; align-items: center; }
    .chips { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip { font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 99px; background: rgba(255,255,255,0.05); border: 1px solid var(--stroke); color: var(--muted); }
    .arrow { width: 32px; height: 32px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid var(--stroke); display: grid; place-items: center; transition: 0.3s; color: var(--text); }
    .award-card:hover .arrow { background: var(--text); color: var(--bg0); transform: rotate(-45deg); }

    .footer { margin-top: 40px; padding: 24px; text-align: center; font-size: 12px; color: var(--muted2); }

    /* ==========================================
       MOLECULE EXPLORER AGENT STYLES
       ========================================== */
    .agent-trigger-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 40px;
      margin-bottom: 20px;
      position: relative;
      z-index: 10;
    }
    
    .agent-trigger {
      position: relative;
      width: 120px; height: 120px;
      border-radius: 50%; background: var(--bg0);
      border: 3px solid var(--a1);
      box-shadow: 0 0 35px rgba(56, 189, 248, 0.6);
      cursor: pointer; display: grid; place-items: center; z-index: 1000;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .agent-trigger::after {
      content: ''; position: absolute; inset: -6px; border-radius: 50%; border: 3px solid var(--a1);
      opacity: 0; animation: pulseRing 1.5s infinite cubic-bezier(0.215, 0.61, 0.355, 1);
    }
    @keyframes pulseRing { 0% { transform: scale(0.95); opacity: 0.8; } 100% { transform: scale(1.5); opacity: 0; } }
    .agent-trigger:hover { transform: scale(1.1) rotate(0deg); }

    .click-text {
        color: var(--text-muted);
        font-size: 0.95rem;
        font-weight: 600;
        opacity: 0.8;
    }
    
    .trigger-img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .agent-window {
      position: fixed; top: 50%; left: 50%; 
      width: min(380px, 92vw); height: 500px; max-height: 85dvh;
      background: var(--ai-window-bg); 
      backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
      border: 1px solid var(--stroke); border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 0 1px var(--stroke); 
      display: flex; flex-direction: column;
      transform: translate(-50%, -45%) scale(0.9); opacity: 0; pointer-events: none; 
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      z-index: 1000; overflow: hidden; text-align: left;
      
      /* THE FIX: Force the GPU to cut off bleeding glass artifacts */
      -webkit-clip-path: inset(0 round 20px);
      clip-path: inset(0 round 20px);
      will-change: transform, opacity;
      backface-visibility: hidden;
      -webkit-font-smoothing: antialiased;
    }
    .agent-window.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: all; }
    
    .agent-header {
      padding: 16px 20px; border-bottom: 1px solid var(--stroke); 
      font-weight: 700; font-size: 14px; letter-spacing: 0.5px; 
      display: flex; justify-content: space-between; align-items: center;
      background: var(--ai-header-bg); color: var(--text);
      touch-action: none;
    }
    
    .header-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header-logo {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 5px var(--a1);
    }
    
    .agent-close { cursor: pointer; opacity: 0.5; padding: 4px; border-radius: 50%; display: grid; place-items: center; transition: 0.2s; } 
    .agent-close:hover { opacity: 1; background: var(--stroke); }

    /* The embedded 3D viewer container */
    .viewer-container {
        height: 0px; 
        width: 100%; 
        /* Deep space background with a subtle cyan glow in the center */
        background: radial-gradient(circle at 50% 50%, rgba(56,189,248,0.15) 0%, rgba(10,10,10,0.8) 70%, #050505 100%);
        position: relative; 
        transition: height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Gives it a slight physical "bounce" when opening */
        border-bottom: 1px solid var(--stroke);
        box-shadow: inset 0 10px 20px rgba(0,0,0,0.5); /* Adds physical depth to the window cut-out */
    }
    .viewer-container.active { height: 220px; }
    .molecule-tag {
        position: absolute; 
        top: 12px; 
        left: 12px; 
        z-index: 10;
        background: rgba(56, 189, 248, 0.1); 
        border: 1px solid rgba(56, 189, 248, 0.4);
        color: var(--a1); 
        font-size: 11px; 
        padding: 4px 10px; 
        border-radius: 4px; /* Sharper corners look more analytical */
        font-family: monospace; /* Monospace feels like raw data */
        font-weight: 700; 
        letter-spacing: 1.5px; 
        text-transform: uppercase;
        backdrop-filter: blur(4px);
        display: none;
    }
    /* --- 2. Custom Glassmorphism Scrollbar --- */
    .chat-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px; font-size: 14.5px; scroll-behavior: smooth; }
    
    .chat-area { scrollbar-width: thin; scrollbar-color: rgba(255, 255, 255, 0.15) transparent; }
    .chat-area::-webkit-scrollbar { width: 6px; }
    .chat-area::-webkit-scrollbar-track { background: transparent; margin-top: 10px; margin-bottom: 10px; }
    .chat-area::-webkit-scrollbar-thumb { 
        background-color: rgba(255, 255, 255, 0.15); 
        border-radius: 10px; 
        transition: background-color 0.3s ease; 
    }
    .chat-area::-webkit-scrollbar-thumb:hover { 
        background-color: var(--a1); 
        box-shadow: 0 0 10px var(--a1); 
    }
    /* --- 3. Message Bubbles & Animation --- */
    .msg { 
        padding: 12px 16px; max-width: 85%; line-height: 1.5; word-wrap: break-word; border-radius: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; transform-origin: bottom left;
    }
    @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .msg-bot { background: var(--ai-bot-bubble); color: var(--text); border: 1px solid var(--ai-bot-border); align-self: flex-start; border-bottom-left-radius: 4px; }
    .msg-user { background: linear-gradient(90deg, var(--a2), var(--a1)); color: white; align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 500; transform-origin: bottom right; }
    .msg b, .msg strong { color: var(--a1); }
    
    .chat-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .chip-btn { background: rgba(56, 189, 248, 0.1); border: 1px solid rgba(56, 189, 248, 0.3); color: var(--a1); border-radius: 16px; padding: 6px 12px; font-size: 12px; cursor: pointer; transition: 0.2s; font-weight: 500; }
    .chip-btn:hover { background: rgba(56, 189, 248, 0.2); transform: translateY(-1px); }

    .input-area { padding: 16px; border-top: 1px solid var(--stroke); display: flex; gap: 10px; background: var(--ai-input-base); }
    .chat-input { flex: 1; background: var(--bg0); border: 1px solid var(--stroke); border-radius: 12px; padding: 10px 14px; color: var(--text); font-family: inherit; font-size: 14px; transition: 0.2s; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
    .chat-input:focus { outline: none; border-color: var(--ai-accent); box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1); }
    .send-btn { background: var(--ai-accent); border: none; border-radius: 12px; width: 42px; display: grid; place-items: center; cursor: pointer; color: var(--ai-user-text); transition: 0.2s; }
    .send-btn:hover { transform: scale(1.05); }
    .send-btn:active { transform: scale(0.95); }

    /* --- 4. Modern Glowing Typing Indicator --- */
    .typing-indicator {
        display: inline-flex; align-items: center; gap: 5px; padding: 6px 4px; height: 24px;
    }
    .typing-dot {
        width: 6px; height: 6px; border-radius: 50%;
        background-color: var(--a1);
        animation: typingBounceGlow 1.4s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        will-change: transform, opacity, box-shadow;
    }
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.15s; }
    .typing-dot:nth-child(3) { animation-delay: 0.3s; }
    @keyframes typingBounceGlow {
        0%, 100% { transform: translateY(0) scale(0.8); opacity: 0.3; box-shadow: 0 0 0px transparent; }
        50% { transform: translateY(-5px) scale(1.2); opacity: 1; box-shadow: 0 4px 12px 2px rgba(56, 189, 248, 0.5); }
    }
  </style>
</head>
<body>
  <div class="bg-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>
  <div class="bg-noise"></div>

  <div class="container">
    <header class="topbar">
      <div class="brand">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle Theme">
          <svg class="sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
          <svg class="moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
        <div class="brand-text">
          <strong>Published Works</strong>
          <span>Synthetic Chronicles</span>
        </div>
      </div>
      
      <button class="menu-btn" id="menuBtn" aria-label="Menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
      </button>
    </header>

    <nav class="menu" id="menuPanel">
      <a href="https://1u477n.github.io/">Home <span>→</span></a>
      <a href="https://1u477n.github.io/about.html">About Me <span>→</span></a>
      <a href="https://1u477n.github.io/techandstrategyconsulting.html">Consulting <span>→</span></a>
      <a href="https://1u477n.github.io/publishedworks.html">Published Works <span>→</span></a>
      <a href="https://1u477n.github.io/workrecognitions.html">Work Recognitions <span>→</span></a>
      <a href="https://1u477n.github.io/blogs/mainpage.html">Blogs <span>→</span></a>
      <a href="https://1u477n.github.io/images/cv.pdf">CV (PDF) <span>↓</span></a>
      <a href="https://www.linkedin.com/in/1u477n/" target="_blank">LinkedIn <span>↗</span></a>
    </nav>

    <section class="hero">
      <h1><span class="grad-text">Published Works</span></h1>
      <p class="subhead">
        A curated list of papers and patents.
      </p>
      
      <div class="agent-trigger-wrapper">
        <div class="agent-trigger" id="agentTrigger" title="Molecular Explorer">
          <img src="https://blueprintaipartners.com/images/logo.gif" alt="AI Agent" class="trigger-img">
        </div>
      </div>
      <div class="click-text">Click me to Chat</div>
    </section>

    <section class="awards-grid">
      <a href="publishedworks/2003_Nanotech.pdf" class="award-card">
        <h3 class="award-title">(2003) MembraneChip - Arrays of Natively Displayed Membrane Targets for Novel Drug Discovery</h3>
        <div class="meta">
          <div class="chips"><span class="chip">NSTI</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/2005_BMCBiotech.pdf" class="award-card">
        <h3 class="award-title">(2005) Cell Membrane Array Fabrication and Assay Technology</h3>
        <div class="meta">
          <div class="chips"><span class="chip">BMC Biotechnology</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/Patent_US6699719.pdf" class="award-card">
        <h3 class="award-title">Patent US6699719, United States - Biosensor Arrays and Methods</h3>
        <div class="meta">
          <div class="chips"><span class="chip">Patent</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/JP4493496B2.pdf" class="award-card">
        <h3 class="award-title">Patent JP4493496B2, Japan - Biosensor Arrays and Methods</h3>
        <div class="meta">
          <div class="chips"><span class="chip">Patent</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/CA2492899A1.pdf" class="award-card">
        <h3 class="award-title">Patent CA2492899A1, Canada - Biosensor Arrays and Methods</h3>
        <div class="meta">
          <div class="chips"><span class="chip">Patent</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/WO2004010074A2.pdf" class="award-card">
        <h3 class="award-title">International Publication WO2004010074A2, WIPO (PCT) - Biosensor Arrays and Methods</h3>
        <div class="meta">
          <div class="chips"><span class="chip">WIPO (PCT)</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/Patent_PCT_US2009_067197.pdf" class="award-card">
        <h3 class="award-title">Patent US2009:067197 - Compositions of Protein Receptor Tyrosine Kinase Inhibitors</h3>
        <div class="meta">
          <div class="chips"><span class="chip">Patent</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/Patent_US8586619.pdf" class="award-card">
        <h3 class="award-title">Patent US8586619, United States - Agents of Calcium Ion Channel Modulators</h3>
        <div class="meta">
          <div class="chips"><span class="chip">Patent</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/CN101686952A.pdf" class="award-card">
        <h3 class="award-title">Patent CN101686952A, China - Agents of Calcium Ion Channel Modulators</h3>
        <div class="meta">
          <div class="chips"><span class="chip">Patent</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>

      <a href="publishedworks/WO2008112715A2.pdf" class="award-card">
        <h3 class="award-title">International Publication WO2008112715A2, WIPO (PCT) - Agents of Calcium Ion Channel Modulators</h3>
        <div class="meta">
          <div class="chips"><span class="chip">WIPO (PCT)</span></div>
          <div class="arrow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </div>
        </div>
      </a>
    </section>

    <footer class="footer">
      © <span id="year"></span> · Published Works · <a href="https://1u477n.github.io/" style="color:inherit">Home</a>
    </footer>
  </div>

  <div class="agent-window" id="agentWindow">
    <div class="agent-header">
      <div class="header-brand">
        <img src="https://blueprintaipartners.com/images/logo.gif" alt="AI Agent" class="header-logo">
        <span>MOLECULAR EXPLORER</span>
      </div>
      <span class="agent-close" id="agentClose">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </span>
    </div>
    
    <div id="molViewerContainer" class="viewer-container">
        <span id="moleculeTag" class="molecule-tag">PDB</span>
    </div>

    <div class="chat-area" id="chatArea">
      <div class="msg msg-bot">
        I am the Molecular Explorer. Ask me to render a specific PDB ID or ask about the molecular targets associated with Luat's patents.
        <div class="chat-chips">
          <button class="chip-btn" onclick="triggerPDBQuery('Visualize TrkA Target')">Visualize TrkA Target</button>
          <button class="chip-btn" onclick="triggerPDBQuery('Show a Calcium Ion Channel')">Calcium Ion Channel</button>
          <button class="chip-btn" onclick="triggerPDBQuery('Tell me about the Biosensor Example')">Biosensor Example</button>
        </div>
      </div>
    </div>
    
    <div class="input-area">
      <input type="text" class="chat-input" id="chatInput" placeholder="Enter PDB ID (e.g., 7XAF) or target name..." autocomplete="off">
      <button class="send-btn" id="sendBtn" title="Send Message">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
      </button>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // Theme Toggle Logic
    (function(){
      const root = document.documentElement;
      const toggle = document.getElementById("themeToggle");
      const storageKey = "theme";
      const media = window.matchMedia("(prefers-color-scheme: light)");

      function updateTheme(theme){
        root.setAttribute("data-theme", theme);
        const meta = document.getElementById("themeColor");
        if(meta) meta.setAttribute("content", theme === "dark" ? "#070A12" : "#F9FAFB");
      }

      const saved = localStorage.getItem(storageKey);
      if(saved) updateTheme(saved);
      else updateTheme(media.matches ? "light" : "dark");

      toggle.addEventListener("click", () => {
        const current = root.getAttribute("data-theme");
        const next = current === "dark" ? "light" : "dark";
        updateTheme(next);
        localStorage.setItem(storageKey, next);
      });
    })();

    // Menu Toggle
    const menuBtn = document.getElementById("menuBtn");
    const menuPanel = document.getElementById("menuPanel");
    
    menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        menuPanel.classList.toggle("open");
    });
    document.addEventListener("click", (e) => {
        if(!menuPanel.contains(e.target) && e.target !== menuBtn) menuPanel.classList.remove("open");
    });

    // ==========================================
    //  MOLECULAR EXPLORER AI LOGIC & 3D VIEWER
    // ==========================================
    const trigger = document.getElementById('agentTrigger');
    const windowEl = document.getElementById('agentWindow');
    const closeBtn = document.getElementById('agentClose');
    const chatArea = document.getElementById('chatArea');
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    
    const molViewerContainer = document.getElementById('molViewerContainer');
    const moleculeTag = document.getElementById('moleculeTag');
    let viewer = null;

    if(trigger) {
        trigger.addEventListener('click', () => { windowEl.classList.add('active'); input.focus(); });
        closeBtn.addEventListener('click', () => windowEl.classList.remove('active'));
    }

    // Initialize 3Dmol viewer
    function initViewer() {
        if(!viewer) {
            viewer = $3Dmol.createViewer(molViewerContainer, { backgroundColor: "rgba(0,0,0,0)" });
        }
    }

    // Function to download and render PDB file
        function loadMolecule(pdbId) {
            molViewerContainer.classList.add('active');
            moleculeTag.style.display = 'block';
            moleculeTag.innerText = `PDB: ${pdbId}`;
            
            initViewer();
            viewer.clear();
            
            // Fetch from RCSB PDB
            $3Dmol.download(`pdb:${pdbId}`, viewer, {onemol: true, multimer: true}, function() {
            
                // 1. WIPE EVERYTHING: Ensure no ghost models or lines carry over
                viewer.removeAllLabels();
                
                // 2. BASE LAYER: Apply the sleek ribbon to literally everything.
                // (3Dmol will naturally only draw ribbons for connected amino acids)
                viewer.setStyle({}, {
                    cartoon: { color: 'spectrum' } // A beautiful, high-end slate white
                });

                // 3. LIGAND LAYER: Overwrite non-protein atoms to glow in cyan
                viewer.setStyle({hetflag: true, not: {resn: ["HOH", "WAT"]}}, {
                    stick: { radius: 0.25, colorscheme: 'cyanCarbon' },
                    sphere: { radius: 0.35, colorscheme: 'cyanCarbon' }
                });

                // 4. WATER LAYER: Explicitly overwrite water molecules to be invisible
                viewer.setStyle({resn: ["HOH", "WAT"]}, {
                    hidden: true
                });

                // 5. POCKET LAYER: Add thin wireframes to the surrounding protein pocket 
                // We use addStyle here so we don't erase the beautiful cartoon ribbon we just made
                viewer.addStyle({within: {distance: 4.0, sel: {hetflag: true, not: {resn: ["HOH", "WAT"]}}}}, {
                    line: { colorscheme: 'lightgreyCarbon' } // Lines perform better than sticks on massive models
                });

                viewer.zoomTo();
                viewer.render();
                
                // 6. Cinematic motion
                viewer.zoom(0.8, 2000); 
                viewer.spin('y', 0.5);  
            });
        }

    // Hide the viewer if no PDB is triggered
    function hideViewer() {
        molViewerContainer.classList.remove('active');
        moleculeTag.style.display = 'none';
    }

    // Expose for the quick-start chips
    window.triggerPDBQuery = function(query) {
        input.value = query;
        handleMessage();
    };

    const luatContext = `SYSTEM INSTRUCTIONS: You are the Molecular Explorer, a digital computational chemistry assistant for Luat Nguyen.
    CONTEXT:
    - TrkA Target: Luat co-authored patents for Receptor Tyrosine Kinase inhibitors. The PDB ID for TrkA in complex with a Pan-Trk Kinase Inhibitor is 7XAF. The TrkA program was acquired by Purdue Pharma for up to $213M.
    - Calcium Ion Channel: Luat holds patents for calcium ion channel modulators. The PDB ID for Human L-type voltage-gated calcium channel Cav1.2 (Class II) in the presence of pinaverium is 8WEA.
    - Biosensor Example: Luat holds patents for biosensor arrays and membrane targets. When asked about this, summarize this article: https://pubmed.ncbi.nlm.nih.gov/15960850/. Explain that it details a technique using cell membrane microarrays to monitor the binding of specific ligands, proving highly effective for novel drug discovery.
    
    STRICT RULES:
    1. Persona: Scientific, direct, and concise. Answer in the first person ("I").
    2. Length: Strictly 3 sentences maximum.
    3. Formatting: Plain text only (no Markdown like **).
    4. Focus: If the user asks about TrkA, Calcium Channels, or Biosensors, mention Luat's specific work and explain the target.

    User question: `;

    let lastAiMessage = "";

    async function handleMessage() {
      const text = input.value.trim();
      if(!text) return;

      const limitKey = "luat_ai_usage";
      const maxQuestions = 3; 
      const today = new Date().toLocaleDateString();
      let usage = JSON.parse(localStorage.getItem(limitKey)) || { count: 0, date: today };

      if (usage.date !== today) usage = { count: 0, date: today };

      if (usage.count >= maxQuestions) {
        const limitMsg = document.createElement('div');
        limitMsg.className = 'msg msg-bot';
        limitMsg.innerHTML = `Molecular rendering limits reached for today to conserve compute. Reach out on <a href='https://www.linkedin.com/in/1u477n/' target='_blank' style='color: var(--a1); font-weight: bold;'>LinkedIn</a>.`;
        chatArea.appendChild(limitMsg);
        chatArea.scrollTop = chatArea.scrollHeight;
        input.value = '';
        return; 
      }
      
      const userMsg = document.createElement('div');
      userMsg.className = 'msg msg-user';
      userMsg.textContent = text;
      chatArea.appendChild(userMsg);
      input.value = '';
      chatArea.scrollTop = chatArea.scrollHeight;

      usage.count++;
      localStorage.setItem(limitKey, JSON.stringify(usage));

      const botMsg = document.createElement('div');
      botMsg.className = 'msg msg-bot';
      botMsg.innerHTML = "Processing Structure<span class='typing-dot'>.</span><span class='typing-dot'>.</span><span class='typing-dot'>.</span>";
      chatArea.appendChild(botMsg);
      chatArea.scrollTop = chatArea.scrollHeight;

      // ---- 3D Molecule Interception Logic ----
      let pdbToLoad = null;
      const lowerText = text.toLowerCase();
      
      // Strict mapping to your requested PDB IDs (Broadened to ensure clicks trigger correctly)
      if (lowerText.includes('trka') || lowerText.includes('tyrosine') || lowerText.includes('7xaf')) {
          pdbToLoad = '7XAF'; 
      }
      else if (lowerText.includes('calcium') || lowerText.includes('8wea')) {
          pdbToLoad = '8WEA'; 
      }
      else if (lowerText.includes('biosensor') || lowerText.includes('pubmed')) {
          hideViewer(); // No 3D model for the biosensor paper summary
      }
      else {
          // Check if they typed a random direct 4-character PDB code
          const match = text.match(/\b([1-9][a-zA-Z0-9]{3})\b/);
          if(match) pdbToLoad = match[1].toUpperCase();
      }

      if(pdbToLoad) {
          loadMolecule(pdbToLoad);
      }

      // ---- Send request to LLM ----
      try {
        let fullPrompt = luatContext;
        if (lastAiMessage !== "") {
            fullPrompt += `\n\nAI's previous message to user: "${lastAiMessage}"`;
        }
        
        // Inject contextual awareness if a PDB is loaded
        if (pdbToLoad) {
            fullPrompt += `\n\n(System Note: The 3D viewer is currently displaying PDB ID ${pdbToLoad}.)`;
        }
        
        fullPrompt += `\n\nUser's current reply: "${text}"`;

        const response = await fetch('https://imaginative-squirrel-aa8082.netlify.app/.netlify/functions/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: fullPrompt })
        });

        const data = await response.json().catch(() => null);

        if (!response.ok) {
            usage.count--;
            localStorage.setItem(limitKey, JSON.stringify(usage));
            throw new Error(data && data.error ? data.error : "HTTP Error " + response.status);
        }

        if (data && data.reply) {
            lastAiMessage = data.reply; 

            // Convert newlines to HTML breaks, and fix any stray **markdown**
            const fullText = data.reply
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            botMsg.innerHTML = ""; 
            
            let i = 0;
            let currentText = "";
            
            function typeWriter() {
                if (i < fullText.length) {
                    if (fullText.charAt(i) === '<') {
                        let tagEnd = fullText.indexOf('>', i);
                        if (tagEnd !== -1) {
                            currentText += fullText.substring(i, tagEnd + 1);
                            i = tagEnd + 1;
                            botMsg.innerHTML = currentText;
                            chatArea.scrollTop = chatArea.scrollHeight;
                            typeWriter();
                            return;
                        }
                    }
                    
                    currentText += fullText.charAt(i);
                    botMsg.innerHTML = currentText;
                    i++;
                    
                    chatArea.scrollTop = chatArea.scrollHeight;
                    setTimeout(typeWriter, 10); 
                }
            }
            typeWriter();
        } else {
            throw new Error("Received an empty response.");
        }
      } catch (error) {
        console.error("Error:", error);
        botMsg.innerHTML = "<span style='color: #fb4934;'><b>System Error:</b> " + error.message + "</span>";
      }
    }

    if(sendBtn) sendBtn.addEventListener('click', handleMessage);
    if(input) input.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleMessage(); });
  </script>
</body>
</html>
